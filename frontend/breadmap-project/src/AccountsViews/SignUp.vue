<template>
  <!-- pt-32ë¡œ ìƒë‹¨ ì—¬ë°±ì„ ëŠ˜ë ¤ í—¤ë”ì™€ ê²¹ì¹˜ì§€ ì•Šê²Œ ìˆ˜ì • -->
  <div class="min-h-screen bg-gradient-to-b from-[#FFF9F0] to-[#E6F4D7] flex items-center justify-center p-4 pt-32 pb-10">
    <div class="w-full max-w-5xl bg-white rounded-[2.5rem] shadow-2xl border-8 border-white overflow-hidden flex flex-col md:flex-row transition-all duration-500 ease-in-out min-h-[600px] relative">
      
      <!-- ê·€ì—¬ìš´ ì½”ê¸° ì¥ì‹ -->
      <img :src="BaguetteCorgi" alt="ë°”ê²ŒíŠ¸ ì½”ê¸°" class="absolute top-6 right-6 w-24 opacity-90 z-20 animate-wiggle origin-bottom">

      <!-- Image Section (Step 1 ì „ìš©) -->
      <div v-if="step === 1" class="w-full md:w-5/12 hidden md:flex items-center justify-center p-8 bg-[#FFF3DD] relative overflow-hidden">
        <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <img src="@/assets/images/ë©”ì¸í™”ë©´.png" alt="Bakery" class="max-w-full h-auto object-contain drop-shadow-xl relative z-10 hover:rotate-3 transition-transform duration-500" style="max-height: 350px;">
      </div>

      <!-- Form Section -->
      <div :class="['p-8 md:p-12 flex flex-col relative transition-all duration-500 bg-white', step === 1 ? 'w-full md:w-7/12' : 'w-full']">
        
        <!-- Step 1: User Info -->
        <div v-if="step === 1" class="flex flex-col justify-center h-full">
          <div class="mb-8">
            <span class="text-[#EF6C00] font-jua text-lg bg-[#FFF3DD] px-3 py-1 rounded-lg">STEP 1</span>
            <h1 class="text-4xl md:text-5xl font-bold text-[#6B4A38] font-jua mt-3 mb-2">í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰</h1>
            <p class="text-[#8B6A55] font-jua text-lg">ë¹µìˆœì´ ë¹µëŒì´ë“¤ì˜ ì²œêµ­ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•´ìš”.<br>AI ë¹µ ì†Œë¯ˆë¦¬ì—ê°€ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</p>
          </div>
          
          <form @submit.prevent="nextStep" class="space-y-4 max-w-md">
            <div>
              <label class="block text-[#6B4A38] font-jua mb-1 ml-1">ì´ë©”ì¼</label>
              <input type="email" v-model="form.email" placeholder="email@example.com" required 
                class="w-full px-5 py-3.5 rounded-2xl bg-[#F9F7F2] border-2 border-[#FFE8CC] font-jua text-[#6B4A38] placeholder-[#C99768]/60 focus:outline-none focus:border-[#F3B37A] focus:bg-white transition-all">
            </div>
            <div>
              <label class="block text-[#6B4A38] font-jua mb-1 ml-1">ë‹‰ë„¤ì„</label>
              <input type="text" v-model="form.nickname" placeholder="ë¹µ êµ½ëŠ” ê³°ëŒì´" required 
                class="w-full px-5 py-3.5 rounded-2xl bg-[#F9F7F2] border-2 border-[#FFE8CC] font-jua text-[#6B4A38] placeholder-[#C99768]/60 focus:outline-none focus:border-[#F3B37A] focus:bg-white transition-all">
            </div>
            <div>
              <label class="block text-[#6B4A38] font-jua mb-1 ml-1">ë¹„ë°€ë²ˆí˜¸</label>
              <input type="password" v-model="form.password1" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required 
                class="w-full px-5 py-3.5 rounded-2xl bg-[#F9F7F2] border-2 border-[#FFE8CC] font-jua text-[#6B4A38] placeholder-[#C99768]/60 focus:outline-none focus:border-[#F3B37A] focus:bg-white transition-all">
            </div>
            <div>
              <label class="block text-[#6B4A38] font-jua mb-1 ml-1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
              <input type="password" v-model="form.password2" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required 
                class="w-full px-5 py-3.5 rounded-2xl bg-[#F9F7F2] border-2 border-[#FFE8CC] font-jua text-[#6B4A38] placeholder-[#C99768]/60 focus:outline-none focus:border-[#F3B37A] focus:bg-white transition-all">
            </div>
            
            <button type="submit" class="w-full py-4 mt-4 font-jua text-xl text-white transition-all duration-300 transform rounded-2xl bg-gradient-to-r from-[#F3B37A] to-[#EF6C00] hover:shadow-lg hover:-translate-y-1 active:scale-95 shadow-md">
              ë‹¤ìŒ ë‹¨ê³„ë¡œ ğŸ¥
            </button>
          </form>

          <div class="mt-6 text-center font-jua text-[#8B6A55]">
            <p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <router-link to="/login" class="text-[#EF6C00] hover:underline">ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°</router-link></p>
          </div>
        </div>

        <!-- Step 2: Bread Preferences -->
        <div v-if="step === 2" class="h-full flex flex-col">
          <div class="flex-none mb-6 text-center md:text-left">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-[#EF6C00] font-jua text-lg bg-[#FFF3DD] px-3 py-1 rounded-lg">STEP 2/2</span>
              <span class="h-px bg-[#FFE8CC] flex-1"></span>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold text-[#6B4A38] font-jua leading-tight">
              <span class="text-[#EF6C00]">{{ form.nickname || 'USER' }}</span>ë‹˜ì˜<br>
              ë¹µ ì·¨í–¥ DNA ë¶„ì„ ğŸ§¬
            </h1>
            <p class="text-[#8B6A55] font-jua mt-2 text-lg">ìì„¸íˆ ì•Œë ¤ì£¼ì‹¤ìˆ˜ë¡ ì¸ìƒ ë¹µì§‘ì„ ì°¾ì•„ë“œë ¤ìš”!</p>
          </div>
          
          <!-- Scrollable Area -->
          <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar pb-6">
            
            <div v-for="(category, index) in preferenceCategories" :key="index" class="mb-8">
              <h3 class="text-xl font-bold text-[#6B4A38] mb-4 flex items-center gap-2 font-jua bg-[#F9F7F2] p-3 rounded-xl inline-block">
                <component :is="category.icon" class="w-5 h-5 text-[#EF6C00]" /> {{ category.title }}
              </h3>
              
              <!-- ì¹´ë“œí˜• ê·¸ë¦¬ë“œ -->
              <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                <button v-for="opt in category.options" :key="opt.name" 
                        @click="togglePreference(opt.name)"
                        :class="['relative p-3 border-2 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 aspect-[4/3] group', 
                                  form.bread_preferences.includes(opt.name) 
                                  ? 'bg-[#EF6C00] border-[#EF6C00] text-white shadow-lg transform -translate-y-1' 
                                  : 'bg-white border-[#FFE8CC] text-[#8B6A55] hover:border-[#F3B37A] hover:bg-[#FFF9F0] hover:shadow-md']">
                  <!-- ì²´í¬ ì•„ì´ì½˜ (ì„ íƒ ì‹œ í‘œì‹œ) -->
                  <div v-if="form.bread_preferences.includes(opt.name)" class="absolute top-2 right-2 w-5 h-5 bg-white text-[#EF6C00] rounded-full flex items-center justify-center text-xs font-bold shadow-sm">âœ“</div>
                  
                  <span class="text-3xl mb-2 filter drop-shadow-sm group-hover:scale-110 transition-transform">{{ opt.emoji }}</span>
                  <span class="text-sm font-bold font-jua whitespace-nowrap">{{ opt.name }}</span>
                </button>
              </div>
            </div>

          </div>

          <!-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ -->
          <div class="flex-none flex gap-4 mt-4 pt-6 border-t-2 border-[#FFE8CC] bg-white">
            <button @click="step = 1" class="w-1/4 py-4 font-jua text-lg text-[#8B6A55] bg-[#FFF3DD] rounded-2xl hover:bg-[#FFE8CC] transition-colors">
              ì´ì „ìœ¼ë¡œ
            </button>
            <button @click="handleSignup" class="w-3/4 py-4 font-jua text-xl text-white transition-all duration-300 transform rounded-2xl bg-gradient-to-r from-[#F3B37A] to-[#EF6C00] hover:shadow-lg hover:-translate-y-1 active:scale-95 shadow-md flex items-center justify-center gap-2">
              <span>ë¹µì§€ìˆœë¡€ ì‹œì‘í•˜ê¸°</span>
              <span class="animate-bounce">ğŸš€</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue';
import { useAuthStore } from '@/stores/auth';
import { RouterLink } from 'vue-router';
import { Smile, Coffee, Utensils } from 'lucide-vue-next';
import BaguetteCorgi from '@/assets/images/ë°”ê²ŒíŠ¸ì½”ê¸°.png';

const step = ref(1);
const form = reactive({
  email: '',
  nickname: '',
  password1: '', 
  password2: '',
  bread_preferences: [],
});

const preferenceCategories = ref([
  {
    title: 'ì„ í˜¸í•˜ëŠ” ì‹ê°',
    icon: Smile,
    options: [
      { name: 'ì«„ê¹ƒí•œ', emoji: 'ğŸ¥¯' },
      { name: 'ë¶€ë“œëŸ¬ìš´', emoji: 'ğŸ' },
      { name: 'ë°”ì‚­í•œ', emoji: 'ğŸ¥–' },
      { name: 'ê¾¸ë•í•œ', emoji: 'ğŸ«' },
      { name: 'ê²°ì´ì‚´ì•„ìˆëŠ”', emoji: 'ğŸ¥' },
      { name: 'í¬ìŠ¬í¬ìŠ¬', emoji: 'ğŸ§' },
    ]
  },
  {
    title: 'ì„ í˜¸í•˜ëŠ” ë§›',
    icon: Coffee,
    options: [
      { name: 'ë‹´ë°±/ìŠ´ìŠ´', emoji: 'ğŸŒ¾' },
      { name: 'ê³ ì†Œí•œ', emoji: 'ğŸ¥œ' },
      { name: 'ë‹¬ì½¤í•œ', emoji: 'ğŸ¯' },
      { name: 'ì§­ì§¤í•œ', emoji: 'ğŸ§‚' },
      { name: 'ìƒí¼í•œ', emoji: 'ğŸ‹' },
      { name: 'ë§¤ì½¤/ìê·¹', emoji: 'ğŸŒ¶ï¸' },
    ]
  },
  {
    title: 'ì„ í˜¸í•˜ëŠ” ì¢…ë¥˜',
    icon: Utensils,
    options: [
      { name: 'í•˜ë“œê³„ì—´', emoji: 'ğŸ¥–' },
      { name: 'ì‹ì‚¬ë¹µ', emoji: 'ğŸ¥ª' },
      { name: 'êµ¬ì›€ê³¼ì', emoji: 'ğŸª' },
      { name: 'ì¼€ì´í¬', emoji: 'ğŸ°' },
      { name: 'ì¡°ë¦¬ë¹µ', emoji: 'ğŸŒ­' },
      { name: 'ë¹„ê±´/ê±´ê°•', emoji: 'ğŸ¥—' },
    ]
  }
]);

const authStore = useAuthStore();

const nextStep = () => {
  if (form.password1 !== form.password2) {
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    return;
  }
  if (form.email && form.nickname && form.password1) {
    step.value = 2;
  } else {
    alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  }
};

const togglePreference = (prefName) => {
  const index = form.bread_preferences.indexOf(prefName);
  if (index > -1) {
    form.bread_preferences.splice(index, 1);
  } else {
    form.bread_preferences.push(prefName);
  }
};

const handleSignup = () => {
  if (form.bread_preferences.length < 3) {
    if(!confirm('ì·¨í–¥ì„ 3ê°œ ì´ìƒ ì„ íƒí•˜ë©´ ë” ì •í™•í•œ ì¶”ì²œì´ ê°€ëŠ¥í•´ìš”! ê·¸ë˜ë„ ì§„í–‰í• ê¹Œìš”?')) return;
  }

  authStore.signup({
    email: form.email,
    nickname: form.nickname,
    password1: form.password1,
    password2: form.password2,
    bread_preferences: form.bread_preferences.join(','),
  });
};
</script>

<style scoped>
@import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

.font-jua {
  font-family: 'Jua', sans-serif;
}

.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: #FFF9F0;
  border-radius: 4px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: #FFE8CC;
  border-radius: 4px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background-color: #F3B37A;
}

@keyframes wiggle {
  0%, 100% { transform: rotate(-3deg); }
  50% { transform: rotate(3deg); }
}

.animate-wiggle {
  animation: wiggle 2s infinite ease-in-out;
}
</style>